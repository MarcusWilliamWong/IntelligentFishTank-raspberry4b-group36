#  智能鱼缸

<div align="center">
<img src="assets\OpenReportTank.jpg" style="zoom:100%;" /> 
</div>

Change README Language: [English](./README.md) ｜ [中文](./README-zh.md)



当前存在问题：

测试部分写在硬件部分还是软件开发部分？



 ## ！！这里放社交媒体链接

```
>[点我访问Instgram账号](https://instagram.com/sleeppandapanda?igshid=ZDdkNTZiNTM=) 

```

 # 1 项目简介：

我们的智能鱼缸项目是以树莓派4B为核心控制器的系统。它主要具有温度控制，含氧量维持，水流速调节等功能。用户可以在手机端查看温度并设定目标温度区间，还可以控制气泡多少和水流速度。

## 1.1 项目功能

### 1.1.1 温度控制-可设定范围

不同种类的鱼需要不同的水温，本系统使用了温度传感器和加热器，两者配合工作，将水域内温度控制在设定值附近。用户可以设定目标温度范围。在系统运行过程中，首先使用Raspberry Pi读取温度传感器数据，将温度数据与设定范围比较，如果当前温度低于设定温度范围，则控制加热器进行加热，当检测到温度达到预定值时停止加热。在加热的过程中，水域内温度将始终作为反馈值参与温度调节。

### 1.1.2 溶解氧维持-可调速气泵

鱼的活动需要氧气，当鱼缸里有很多鱼时这非常重要，本系统使用了PWM调节电子开关控制板来控制气泵的运行功率。用户可以设定需要的工作档位。

### 1.1.3 自然环境模拟-可调节流速控制

生命在于运动。平静的水流对鱼完全没有吸引力。本系统使用了PWM调节电子开关控制板来控制气泵的运行功率，用户可以设定需要的工作档位，这使得鱼的游动姿态更美观，进食更方便。

### 1.1.4 移动端控制

以上所提到的一切都无需用户调试树莓派或修改代码中的参数，而是使用我们基于Flutter设计的移动端应用来便捷的蓝牙传输参数，设置保温范围，加热功率，气泡量以及水流速度。

## 1-2 项目贡献者

| Name         | Student ID | Role |
| ------------ | ---------- | ---- |
| Haoshi Huang |            |      |
| Xintong LIN  | 2824115L   |      |
|              |            |      |
|              |            |      |

## 1-3 项目规划

Haoshi Huang



Xintong LIN



<div align="center">
<img src="assets\GanttChart.png" style="zoom:100%;" /> 
</div>

<p align="center">甘特图</p>  

## 1-4 测试视频

## ！！在这里放最后测试视频



# 2 软硬件信息

## 2.1 系统与控制器

Raspberry Pi 4B是一款基于ARM架构的微型电脑。它采用了由博通公司出品的、集成了GPU和CPU的BCM2711芯片，支持4K分辨率视频输出，最大支持4GB LPDDR4-3200 SDRAM内存，支持Gigabit以太网、双频WiFi、蓝牙5.0等多种接口和协议。它还有两个Micro-HDMI接口、两个USB3.0接口、两个USB2.0接口、一个40针GPIO接口、一个2针电源接口等。

## ！！黄老板写点软件版本信息

<div align="center">
<img src="assets\RaspberryPi4B.jpg" style="zoom:50%;" /> 
</div>

<p align="center">Raspberry Pi 4B</p>  



## 2.2 电源

在同功率下，高电压会带来较低的电流，而低电压会带来更大的电流，这会导致发热更为严重，综合考虑了安全性与系统其他部件的用电需求后，我们决定使用24V加热器进行加热。

我们选用了一款名为DT-NT24V的恒压直流电源进行供电，它可以将 230V的交流电转换为24V的低压直流电。这是一款设计紧凑的电源，有蜂窝状散热设计，有半透明盖板对接线端子进行保护，可提供过压、过热、过流和短路保护，可以进行小电流输出，电压波纹小，运行噪音低。它可以提供最高6.25安培的电流，功率可以达到150瓦特。

<div align="center">
<img src="assets\PowerSupply.png" style="zoom:50%;" /> 
</div> 

<p align="center">电源</p>  

## 2.3 电压转换器

我们使用了一款基于LM2596S稳压器设计的DC-DC降压器，当输入电压为4.0V 至 40V时，输出电压可以通过外部分压电阻进行调整，范围为 1.23V 至 37V。同时，输出电流为2安培（正常稳定）和最大3安培，足以驱动许多电子设备。它的转换效率可以达到92%，输出纹波在30mV以下，开关频率150KHz，工作温度-45至85摄氏度。为了提高系统的稳定性，我们为每一个系统都配备了独立的电源。

<div align="center">
<img src="assets\VoltageConvertor.png" style="zoom:70%;" /> 
</div>

<p align="center">LM2596S 电压转换器</p>  

## 2.4 PWM调节电子开关控制板

PWM（Pulse Width Modulation）是一种广泛应用于电子和通信领域的技术。它通过控制脉冲波形的宽度（即脉冲的持续时间）来调整信号或电源的有效值。在PWM信号中，脉冲宽度的比例（占空比，duty cycle）与所表示的模拟信号或输出电压成正比。占空比是指在一个完整的PWM周期内，高电平状态所占的时间与整个周期时间的比例。占空比的范围通常在0%（全低电平）到100%（全高电平）之间。我们利用PWM技术，实现了对加热器，气泵与水泵的控制，通过调整PWM信号的占空比，可以精确控制电机的速度和扭矩。

我们使用的这款PWM调节电子开关控制板可以对5V-36V的直流电进行调控，使用3.3V-20V之间的直流电进行触发，在散热良好的情况下连续电流最高可达15A，功率可达400W。这款PWM调节电子开关控制板采用双MOS并联有源输出，具有低内阻，高功率的特点，支持频率在0--20KHZ之间的PWM信号。

<div align="center">
<img src="assets\MotorControl.png" style="zoom:100%;" /> 
</div>

<p align="center">PWM调节电子开关控制板</p>  

## 2.5 气泵

气泵在鱼缸中扮演着重要的角色，气泵通过产生气泡，将空气中的氧气输送到鱼缸水中。当气泡破裂时，氧气释放到水中，从而为鱼类提供充足的氧气。足够的氧气对于鱼类的生长、新陈代谢和生存至关重要。气泵产生的气泡在上升过程中，可以带动水流产生循环。水流的循环有助于水中的营养物质、废物和氧气在鱼缸内均匀分布，使鱼类生活环境更加舒适。气泵提供的氧气有助于有益细菌的生长。这些细菌可以分解鱼类排泄物中的氨、亚硝酸盐等有毒物质，将其转化为无害的硝酸盐。这有助于维持鱼缸水质的稳定，为鱼类提供一个健康的生活环境。

这款气泵重约150g，采用增压电陶瓷电机，使用5V电源进行供电，功耗约为1W，最大流量为210L/H。具有供氧稳定，发热低，噪音低的特点。

我们通过PWM对气泵实现分级调速，设置了包含关闭在内的五个速度级别，用户可以在移动端选择需要的速度级别。

 <div align="center">
<img src="assets\AirPump.png" style="zoom:50%;" /> 
</div>

<p align="center">气泵</p>  

## 2.6 水泵

水泵可以推动水流循环，这有助于水中的氧气、营养物质和废物在鱼缸内均匀分布，从而为鱼类提供一个舒适的生活环境。水泵可以将水中的废物输送到过滤器，提高过滤器的工作效率，帮助维持水质。水泵产生的水流可以帮助模拟自然环境中的水流，使鱼缸形成一个良好的生态平衡。这对于鱼类的生长、繁殖以及整个鱼缸生态系统的稳定非常重要。水泵产生的水流可以带动鱼缸中的装饰物，如仿真水草、喷泉等，为鱼缸增添动感和美观效果。

这款水泵长38毫米，宽38毫米，高29毫米，重约125g，使用4.5V~12V的直流电进行驱动，水流量可以达到100~350L/H，功率可达0.5~5W。它可以在40db以下的声级下安静地工作，通过吸盘吸附在鱼缸表面上。

我们通过PWM对水泵实现分级调速，设置了包含关闭在内的五个速度级别，用户可以在移动端选择需要的速度级别。

  <div align="center">
<img src="assets\WaterPump.jpg" style="zoom:60%;" /> 
</div>

<p align="center">水泵</p>  

## 2.7 浸入式电阻式加热器

浸入式电阻式加热器是一种利用电阻发热的原理来加热水的设备。它主要由电阻发热元件、外壳、温度控制器和绝缘材料等部分组成。在加热器中，电阻发热元件是核心部件，它将电能转化为热能，从而实现对水的加热，同时，电阻发热元件直接与水接触，热量传递效率较高，因此加热速度较快。当电流通过电阻发热元件时，由于电阻元件的电阻作用，电流会产生焦耳热。这种热量会被传递到水中，使水温升高。通过调整PWM信号的占空比，可以控制加热元件产生的热量，从而实现对水温的控制。

我们采用的加热器可以工作在24V的电压下，并且最大功率可以达到140瓦特。

  <div align="center">
<img src="assets\Heater.png" style="zoom:50%;" /> 
</div>

<p align="center">浸入式电阻式加热器</p>  

## 2.8 温度传感器

DS18B20 是一款能够在 -55°C 至 +125°C 的范围内测量温度的数字温度传感器。当温度在 -10°C 至 +85°C 范围内时，DS18B20 的测量精度可达到 ±0.5°C。它可以将测量到的温度值转换为数字信号，便于微控制器等数字设备读取和处理。输出数据为 9 位至 12 位可编程分辨率的数字信号。DS18B20 使用一根数据线（1-Wire 协议）与微控制器进行通信，可以简化接线和减少硬件成本。

  <div align="center">
<img src="assets\TemperatureSensor.png" style="zoom:30%;" /> 
</div>

<p align="center">DS18B20温度传感器</p>  

同时，由于DS18B20采用单总线数据传输，为了确保数据线上的电平稳定和可靠地进行数据传输，需要在数据线上连接一个上拉电阻。上拉电阻将数据线连接到正电源上，以确保数据线处于高电平状态。当要发送低电平信号时，数据线上的电平将被拉低，并且由于上拉电阻的存在，数据线上的电流将非常小，从而实现了低电平信号的发送。此外，上拉电阻还可以防止数据线上的电磁干扰和电气噪声，提高数据传输的可靠性。

  <div align="center">
<img src="assets\WiringDiagram-temperaturesensor.jpg" style="zoom:30%;" /> 
</div>

<p align="center">DS18B20温度传感器接线</p>  

## 2.9 连接件

在连接性方面，为了方便测试，我们使用了2针的JST 插头，这是一种广泛应用于各种电子设备和电气应用的连接器，具有小巧轻便、插拔方便和稳定性好的优点，同时设计有锁扣与单向插槽，因此该插头不容易意外松脱，同时不会出现电源接反的情况。在线材上，我们主要使用了规格为22AWG的线材，最大电流可以通过5-7安培。考虑到加热元件的功率与运行电压，并且为了降低发热以及提高稳定性，因此我们在加热元件的连接上使用了两根此规格的线材。

  <div align="center">
<img src="assets\JST .jpg" style="zoom:30%;" /> 
</div>

<p align="center">JST 插头</p>  

## 2.10 端口分配

   <div align="center">
<img src="assets\WiringDiagram-Raspberry4bPinOut.png" style="zoom:50%;" /> 
</div>

<p align="center">Raspberry Pi 4B接口</p>  

   <div align="center">
<img src="assets\InterfaceAssignment-zh.png" style="zoom:50%;" /> 
</div>
<p align="center">Raspberry Pi 4B端口分配</p>  

使用串行通讯的蓝牙模块需要使用TX和RX端口，同时使用W1总线进行通讯的DS18B20需要使用GPIO4端口（默认W1端口）进行通讯。

**备注：**

GPIO4通常是默认的W1端口，而树莓派的其他端口也可以通过配置为W1端口而用于连接1-Wire设备。

如果要将其他端口配置为W1端口，可以进行以下操作：

1. 使用文本编辑器打开/boot/config.txt文件

2. 在文档最后添加：dtoverlay=w1-gpio,gpiopin=<W1引脚号>

3. 保存并关闭文件，重新启动树莓派

   需要注意的是在“dtoverlay=w1-gpio,gpiopin=<W1引脚号>”中，“,”不应有空格，不然配置会无效

## 2.11 原理图与实物图

电源连接230V交流电，输出24V直流电，在经过第二次电压转换后获得需要的5V或3.3V电压。

PWM调节电子开关控制板的输入端连接电压转换器，输出端连接负载，控制端的PWM端口连接树莓派的GPIO端口，GND与树莓派的GND相连。

   <div align="center">
<img src="assets\WiringDiagram1.png" style="zoom:80%;" /> 
</div>

<p align="center">原理图</p> 

   <div align="center">
<img src="assets\WiringDiagram2.png" style="zoom:80%;" /> 
</div>

<p align="center">模拟接线图</p> 

 <div align="center">
<img src="assets\WiringDiagram3.jpg" style="zoom:80%;" /> 
</div>

<p align="center">实物接线图</p> 

# 3 系统开发

## 3.1 软件架构



## 3.2 XX部分

## 3.3 XX部分



## 黄老板来写





# 4 单元测试

## 4.1 尺寸问题





# 5 问题与总结





 

 

 

 

 

 

 

 

 